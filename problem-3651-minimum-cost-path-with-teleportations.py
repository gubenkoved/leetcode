import collections
import heapq
from typing import List


class Solution:
    def minCost(self, grid: List[List[int]], k: int) -> int:
        teleport_targets = collections.defaultdict(list)

        rows = len(grid)
        cols = len(grid[0])

        for r in range(rows):
            for c in range(cols):

                for r2 in range(rows):
                    for c2 in range(cols):

                        if r2 == r and c2 == c:
                            continue

                        if grid[r2][c2] <= grid[r][c]:
                            teleport_targets[(r, c)].append((r2, c2))

        heap = [
            # (cost, -teleports left, (r, c), )
            (0, -k, (0, 0)),
        ]

        visited = set()

        finish = (rows - 1, cols - 1)

        while heap:
            cost, k_left_neg, pos = heapq.heappop(heap)

            if (pos, k_left_neg) in visited:
                continue

            visited.add((pos, k_left_neg))

            if pos == finish:
                return cost

            r, c = pos

            candidates = [
                (r + 1, c),
                (r, c + 1),
            ]

            for nr, nc in candidates:
                if nr >= rows or nc >= cols:
                    continue
                pos = (nr, nc)
                if (pos, k_left_neg) not in visited:
                    heapq.heappush(heap, (cost + grid[nr][nc], k_left_neg, pos))

            # tele-neighbors
            if k_left_neg < 0:
                for nr, nc in teleport_targets[(r,c)]:
                    pos = (nr, nc)
                    if (pos, k_left_neg) not in visited:
                        heapq.heappush(heap, (cost, k_left_neg + 1, pos))

        assert False, 'unreachable'


if __name__ == '__main__':
    x = Solution()
    # print(x.minCost([[6, 7, 1,  20, 11],
    #                  [4, 5, 18, 23, 28]], 3), 46)
    #
    # print(x.minCost([[9, 2, 7, 9,17,11,6, 23,24],
    #                  [17,10,19,8,19,18,27,16,23]], 2), 23)

    # print(x.minCost([[19,10],
    #                  [23,13],
    #                  [16,32],
    #                  [38,41],
    #                  [30,36],
    #                  [53,31]], 1), 55)

    print(x.minCost([[431,47,460,104,174,384,326,280,525,406,303,270,452,386,134,189,60,564,102,351,455,589,3,334,17,529,406,149,536,199,606,509,143,603,441,316,160,249,330,27,586,56,563,57,602,80,534,106,551],[725,143,565,571,695,511,219,676,346,551,276,731,448,592,317,185,419,705,287,404,378,660,404,424,670,600,411,341,490,664,539,605,406,288,246,212,229,669,633,420,510,203,325,107,243,394,327,127,133],[467,188,517,172,733,318,504,387,485,470,405,467,425,793,518,755,399,533,255,284,685,287,168,409,484,399,412,563,777,443,307,487,325,739,803,786,791,588,702,332,686,165,165,221,386,278,275,650,615],[731,833,769,548,451,866,736,440,802,339,574,733,446,563,510,340,440,587,849,542,353,424,410,216,702,593,243,311,853,636,856,656,228,407,627,754,648,626,443,564,825,512,605,692,854,847,776,768,340],[801,372,787,802,367,604,373,737,531,668,902,702,876,304,465,665,921,337,566,605,865,592,914,853,453,841,914,502,307,394,281,595,334,571,361,409,687,560,868,925,296,342,921,652,573,845,881,770,327],[974,401,895,797,853,472,802,906,902,704,438,933,739,588,681,596,999,480,373,991,344,741,387,737,993,733,833,400,731,366,441,420,941,767,935,505,541,498,674,555,785,646,641,508,943,395,471,485,546],[423,992,896,800,987,833,754,878,799,429,1049,682,786,542,533,705,696,775,1044,812,880,613,657,920,817,987,798,859,409,513,504,745,597,548,1048,421,1053,463,420,888,509,663,916,1015,1030,680,1019,601,588],[758,985,1051,1121,1002,551,918,542,922,878,1085,723,640,655,694,575,864,609,697,1025,476,540,852,958,502,719,511,534,937,892,980,524,733,794,626,776,520,976,496,681,1056,1120,681,818,920,613,583,1044,798],[618,889,1130,583,1048,545,1185,965,836,727,871,906,983,840,816,756,575,1163,804,968,573,1151,890,783,949,558,581,705,1122,549,1029,1204,971,984,934,1132,1112,1033,895,593,965,577,900,917,540,964,624,1025,919],[1189,864,1106,811,1100,799,1151,1186,959,1120,829,723,1051,1002,824,1259,707,872,632,641,1251,778,1149,1065,835,855,1162,733,908,1268,1033,685,655,1012,1225,859,1090,621,952,1178,931,714,1001,775,1055,1057,1015,876,766],[971,704,1029,979,1133,1147,782,1314,1328,1035,855,920,892,772,976,788,908,672,807,1044,1194,719,848,1050,710,1230,865,1039,965,834,1301,1241,694,973,728,1184,790,1203,1061,692,888,1034,1083,752,1182,1095,1219,786,1217],[1321,758,771,955,745,1055,788,1195,1193,983,1120,794,1260,775,831,1237,836,838,1080,1101,1385,999,1116,861,1342,1029,1402,1180,1348,1146,816,995,1339,1324,1023,966,1157,883,938,930,1080,1177,740,1407,1021,1299,969,753,1219],[1152,1137,1413,896,869,1008,1451,1007,887,909,1005,820,1317,1385,1393,1280,1123,1060,1449,1300,1303,1090,920,1193,1142,1288,1282,1435,1282,1470,1219,1215,972,1042,1052,822,810,1002,1257,1320,1181,832,1188,1082,820,1423,1294,1283,939],[1006,1196,1067,1166,1166,955,1235,1541,1124,1122,1437,1230,1496,1235,1474,1349,1352,977,1296,978,1183,1000,967,883,1376,1150,1297,1389,1117,925,1501,1522,1383,1406,1061,1127,1087,1246,1089,1243,1130,1502,1448,1281,1172,1176,1008,1116,1264],[1031,1277,1093,1078,1214,1111,1366,1054,1200,1605,1246,1505,1352,1081,1499,1251,1179,1401,1234,1253,975,1352,1544,957,1049,1593,1457,995,1418,1071,1370,964,1015,1493,1185,1278,1313,1500,1488,1139,1281,1218,1183,1065,1192,1233,1487,1180,1510],[1039,1295,1321,1524,1250,1427,1305,1150,1447,1008,1414,1388,1274,1430,1020,1231,1200,1267,1157,1042,1265,1167,1657,1181,1528,1489,1016,1086,1626,1225,1200,1317,1264,1070,1407,1079,1459,1527,1529,1663,1492,1481,1426,1167,1262,1180,1475,1100,1475],[1120,1318,1507,1676,1132,1466,1698,1284,1685,1169,1550,1194,1653,1686,1436,1279,1481,1696,1407,1398,1412,1736,1263,1118,1311,1371,1251,1083,1276,1382,1134,1380,1500,1407,1475,1415,1479,1393,1183,1361,1095,1546,1247,1406,1542,1719,1681,1638,1592],[1785,1776,1649,1422,1449,1793,1286,1368,1546,1269,1162,1378,1741,1774,1233,1285,1706,1277,1198,1549,1301,1335,1286,1200,1792,1756,1713,1318,1609,1672,1388,1746,1231,1249,1157,1585,1224,1436,1279,1423,1555,1697,1256,1400,1734,1398,1770,1211,1673],[1764,1276,1456,1431,1424,1784,1336,1601,1283,1396,1372,1258,1707,1238,1625,1272,1708,1441,1311,1631,1510,1261,1337,1473,1749,1577,1481,1823,1716,1214,1516,1768,1323,1605,1643,1717,1425,1602,1712,1689,1834,1876,1565,1849,1340,1396,1857,1411,1461],[1601,1407,1304,1334,1862,1451,1586,1428,1472,1935,1796,1511,1687,1682,1523,1601,1374,1452,1580,1752,1351,1378,1876,1398,1444,1753,1441,1562,1348,1378,1325,1863,1737,1921,1869,1504,1317,1816,1832,1374,1825,1431,1583,1485,1552,1912,1393,1756,1281],[1999,1375,1683,1968,1445,1411,1507,1852,1775,1582,1835,1410,1932,1510,1523,1453,1517,1682,1829,1747,1760,1947,1602,1457,1879,1668,1703,1926,1406,1720,1389,1349,1528,1434,1621,1975,1469,1974,1736,1392,1397,1883,1974,1443,1478,1962,1655,1544,1491],[1658,1938,2054,2065,1584,1772,1452,2039,1997,1783,1908,1737,1788,1417,1819,1435,1851,1503,1758,1538,1926,1844,1993,1724,1990,1885,1989,1644,1497,1668,1452,1914,1697,1928,1988,1439,1834,2077,1756,1635,1541,1670,1457,2012,1929,1776,1900,1711,1686],[1606,1812,1802,1962,1765,1808,1579,1529,1923,2063,1956,1512,1941,1919,1909,2048,1947,1661,1614,2068,2038,1773,2081,1884,1652,2005,2008,1622,1632,1957,1876,2069,1975,1591,1548,2086,2003,1613,2060,1691,1806,2077,1481,1726,1933,1987,1942,1970,2055],[2004,1552,2071,1856,2097,1714,1638,1930,1557,1546,1657,1738,1611,1964,1581,1728,2145,1694,2031,1784,2210,2088,1652,1645,2026,1949,2077,1762,1890,1689,2126,2159,1951,1695,1919,1583,1726,1647,2050,1579,1745,1958,1557,2005,2199,2162,2164,2083,1913],[1689,2179,2060,2139,2168,2179,2200,1833,2086,2036,1754,1753,1802,2121,1710,2020,2144,1868,1820,2224,2122,2065,2120,2163,1935,2001,2128,2252,2269,2244,1713,2252,2069,2194,1933,1827,1940,2189,2019,2106,2031,1631,2213,2039,1808,1796,1892,1850,1859],[1722,1902,2060,1894,1960,2256,1682,1864,2110,2182,1749,1861,2260,2223,1888,2241,1755,2110,1983,2305,1891,1851,2082,2247,1866,2183,1746,2055,1683,2268,1794,1977,2034,2064,1679,2052,2029,2306,2156,2002,2011,1868,2012,1721,2057,2013,2200,1872,1763],[2136,2359,2156,1910,1771,1926,2359,1832,1767,2382,2265,2321,1789,1759,2247,2045,2280,2126,2370,2374,1837,2233,2165,2184,1803,2370,2192,2328,2259,2183,2098,1842,1975,2022,1917,2264,2315,2069,2299,1804,2175,2171,1898,1841,2167,2395,1785,2347,1832],[1850,2067,2030,2267,2256,2277,1990,2207,1944,2376,1845,2296,2258,2462,2470,1925,1828,1864,1982,2187,2467,2456,2424,2242,2099,1922,2209,2193,1887,2018,1963,1934,2117,2216,2057,2095,2183,2199,2147,2418,1813,1809,2306,2062,2357,2055,1879,2030,2012],[1950,2387,2060,2109,2468,1908,2078,1941,2478,2046,2073,2020,2392,2428,2362,2359,2161,2016,2202,2276,2322,2288,2344,2204,2338,2159,2357,2045,2509,2202,2351,2214,2537,1960,2248,2257,2436,1960,1912,2110,2049,2521,1895,2395,2064,2372,2320,2121,1887],[2105,2126,2165,2168,2468,2213,2096,2377,2028,2314,2254,2279,1995,2531,2196,2067,2604,2550,2328,1971,2384,2371,2069,2563,2103,2049,2280,2188,2303,2013,2079,2312,2416,2267,2610,2381,1990,2055,2150,2091,2043,2257,2486,2170,2413,2262,2376,2280,2531],[2032,2460,2492,2538,2576,2483,2083,2165,2304,2593,2184,2363,2619,2429,2353,2447,2584,2333,2322,2357,2629,2585,2484,2081,2360,2166,2389,2120,2643,2611,2308,2550,2315,2347,2140,2079,2188,2569,2384,2563,2515,2676,2335,2391,2627,2257,2466,2631,2056],[2454,2246,2099,2550,2720,2468,2174,2576,2219,2181,2334,2439,2243,2141,2557,2185,2496,2606,2081,2192,2169,2163,2156,2335,2362,2579,2104,2697,2740,2698,2701,2197,2313,2340,2109,2162,2731,2357,2266,2276,2638,2696,2361,2686,2303,2613,2705,2548,2573],[2413,2620,2536,2676,2202,2272,2678,2391,2369,2267,2181,2196,2671,2811,2290,2498,2308,2399,2637,2244,2724,2494,2241,2219,2688,2736,2148,2756,2570,2538,2478,2382,2491,2579,2342,2430,2345,2355,2452,2403,2397,2239,2347,2160,2481,2669,2782,2202,2596],[2705,2381,2504,2771,2342,2763,2263,2505,2670,2256,2397,2411,2648,2250,2485,2219,2821,2481,2378,2583,2299,2707,2871,2373,2265,2619,2373,2285,2636,2551,2246,2676,2417,2260,2564,2388,2550,2624,2829,2275,2289,2538,2716,2552,2225,2721,2294,2436,2351],[2829,2399,2842,2842,2548,2617,2865,2782,2833,2816,2893,2565,2418,2599,2552,2392,2333,2427,2934,2514,2344,2508,2902,2518,2932,2946,2855,2631,2368,2778,2801,2790,2725,2865,2912,2348,2305,2829,2416,2334,2476,2570,2804,2891,2856,2733,2407,2285,2382],[2927,2552,2763,2885,2569,2441,2412,2540,2785,2617,2703,2880,2548,2855,2393,3010,2362,2876,2654,2672,2754,2831,2598,2522,2550,2663,2619,2465,2663,2748,2623,2514,2616,2540,2897,2707,2356,3012,2893,2723,2681,2654,2557,2456,2877,2398,2497,2611,3082]], 9))