//go:build ignore

package main

import (
	"container/heap"
	"fmt"
)

var M int = 1e9 + 7

type Fenwick struct {
	data []int
}

// least significant bit
func lsb(x int) int {
	return x & -x
}

func (tree Fenwick) Query(x int) int {
	result := 0
	for x != 0 {
		result = (result + tree.data[x]) % M
		x -= lsb(x)
	}
	return result
}

// sum for [from, to]
func (tree Fenwick) RangeSum(from, to int) int {
	result := tree.Query(to)
	result -= tree.Query(from - 1)
	return (M + result) % M
}

func (tree *Fenwick) Update(x int, delta int) {
	if x <= 0 {
		panic("bad")
	}

	for x < len(tree.data) {
		tree.data[x] += delta
		x += lsb(x)
	}
}

func NewFenwick(size int) *Fenwick {
	return &Fenwick{
		data: make([]int, size+1),
	}
}

type ValueWithPosition struct {
	Value    int
	Position int // position inside the original array (it is NOT used to implement indexed heap)
}

type IntHeap []ValueWithPosition

func (h IntHeap) Len() int {
	return len(h)
}

func (h IntHeap) Less(i, j int) bool {
	return h[i].Value < h[j].Value
}

func (h IntHeap) Swap(i, j int) {
	tmp := h[i]
	h[i] = h[j]
	h[j] = tmp
}

func (h *IntHeap) Push(x any) {
	*h = append(*h, x.(ValueWithPosition))
}

func (h *IntHeap) Pop() any {
	el := (*h)[len(*h)-1]
	*h = (*h)[:len(*h)-1]
	return el
}

func countPartitions(nums []int, k int) int {
	n := len(nums)

	// left/right inclusive ranges for the window where min/max constraint is true
	left := n
	right := n - 1 // bear with me!

	// given we need value at 0 index we will offset all QUERY/UPDATES by +1
	// we also need to be able to set at n-th index
	fenwick := NewFenwick(n + 1)

	// boundary condition (e.g. [x] -> should result in 1)
	fenwick.Update(n+1, +1)

	// tracking minimums/maximums inside the window
	mins := IntHeap{}
	maxs := IntHeap{}

	for left != 0 {
		// advance left
		left -= 1

		heap.Push(&mins, ValueWithPosition{nums[left], left})
		heap.Push(&maxs, ValueWithPosition{-nums[left], left})

		// position right so that it points to the right side of the range
		// still complying with requirements
		for {
			// drop out of range min/max if applicable
			for mins[0].Position > right {
				heap.Pop(&mins)
			}
			for maxs[0].Position > right {
				heap.Pop(&maxs)
			}
			if (-maxs[0].Value)-mins[0].Value > k {
				right -= 1
			} else {
				break
			}
		}

		cur := fenwick.RangeSum(left+1+1, right+1+1)

		fenwick.Update(left+1, +cur)
	}

	return fenwick.Query(0 + 1)
}

func main() {
	fmt.Println(countPartitions([]int{1, 2, 3, 4, 5}, 0), 1)
	fmt.Println(countPartitions([]int{1, 2, 3, 4, 5}, 5), 16)
	fmt.Println(countPartitions([]int{9, 4, 1, 3, 7}, 4), 6)
	fmt.Println(countPartitions([]int{3, 3, 4}, 0), 2)
	fmt.Println(countPartitions([]int{81649451, 728693870, 727831515, 32578854, 77011223, 121714321, 873051798, 445444804, 602859674, 782272643, 922161046, 460814248, 512918025, 567513836, 359677254, 39129563, 872078694, 164027913, 793336080, 575524327, 167035002, 927750715, 128814795, 642029377, 352689691, 831337680, 407905607, 790915153, 28911125, 706685584, 148121273, 538511642, 610697851, 856027274, 888256914, 65097972, 799304363, 570398061, 789361428, 242558756, 419954443, 883643140, 205137024, 386828861, 84096584, 517811813, 393121465, 262263413, 294913523, 592921925, 321116600, 232280796, 720051631, 397245330, 553718857, 366585223, 628206739, 658217998, 627205627, 274205499, 777897683, 192320828, 675864163, 61758130, 156523097, 361961509, 139126791, 410887488, 413395317, 802435689, 673095481, 640848858, 151638419, 417131349, 507018986, 423064856, 456876415, 265016226, 934632293, 66080145, 418418350, 950536968, 557283761, 543846455, 943027393, 497545753, 53639041, 37495843, 542036283, 144846369, 806735409, 430758090, 112982959, 480606009, 453658676, 998145321, 909385526, 711872309, 76793293, 221798523, 798941111, 720582595, 716402385, 187667266, 992312063, 534331633, 91405341, 69723774, 815320883, 713478162, 495099879, 803316632, 777543562, 467082179, 364417388, 627184333, 168029094, 125306080, 353492215, 900877063, 202714051, 840346611, 156698416, 613282449, 483986471, 196932642, 773470465, 866934494, 490447522, 971545973, 471360402, 557602855, 14730628, 608372907, 949690952, 8546585, 785131037, 314738659, 53915737, 16396870, 318194623, 387668610, 871192887, 70091408, 494562383, 47332279, 214702761, 958176568, 81126547, 258279088, 46304146, 6173956, 851082221, 662618235, 594667236, 49858966, 828027747, 380632423, 702663835, 842909379, 535154523, 862599832, 763797107, 218822756, 967726249, 471750152, 151233073, 423569649, 877536308, 198744124, 469956083, 829068869, 817492030, 833223639, 586883458, 122497526, 994012213, 339260466, 582950956, 302053538, 701313292, 993405679, 456351932, 799404041, 797486429, 419402718, 317378933, 609893565, 95366914, 653569709, 210559973, 148477370, 234031762, 89586834, 881213511, 371124530, 898390104, 12336595, 504186167, 614212617, 32574282, 742455413, 691641412, 469678368, 293771807, 151820155, 943267664, 325675830, 213118582, 479273740, 171714268, 823349892, 800003183, 630285663, 939653138, 895413671, 228972390, 985260503, 67381417, 763220182, 785040219, 484820387, 229147702, 990393989, 876544070, 774691369, 746726865, 528096534, 71908960, 708592178, 100942521, 590738136, 983759253, 508809722, 592073800, 614740003, 690372666, 721855692, 251407470, 717955696, 742581837, 575918563, 659128663, 226251865, 572437141, 315949046, 786296864, 824758392, 816527002, 880089682, 563970184, 664416525, 792879660, 370043624, 968914328, 9847912, 435280877, 359009873, 968783221, 402335283, 262574256, 909397230, 482722034, 844459423, 6447753, 244359875, 467224160, 163782341, 206261134, 398547641, 933986436, 548509730, 976337473, 454484935, 439005386, 303939359, 261947323, 375737791, 817949090, 837933664, 417950264, 97024765, 324152822, 835268295, 375640514, 224907487, 677160704, 378877736, 550871332, 56834378, 936428511, 31894129, 165562979, 690935091, 732304463, 450583058, 349847877, 969813876, 782044142, 963003180, 403875834, 69822328, 54624470, 364144679, 374427035, 305456159, 109470540, 245286165, 354622610, 172249407, 438508820, 494817139, 93162461, 799135225, 195856081, 335962383, 226043908, 486044522, 298852626, 829067819, 522127921, 412615167, 713233416, 8921499, 933280186, 48925063, 862043329, 550009948, 81421856, 465860978, 348271216, 136561414, 99239798, 975810900, 820578718, 65469407, 129995145, 796525278, 794391034, 747030337, 459677156, 691436858, 484834339, 455608297, 511524741, 438604425, 52105694, 656571401, 686370691, 162661314, 460112501, 647004863, 486692550, 796561611, 699822427, 482493891, 958977723, 455261571, 497933733, 129383734, 220374212, 37994379, 644146815, 751692723, 188336289, 702950150, 466089525, 650745121, 269999828, 345198389, 603905254, 316160641, 907668299, 335797962, 45142608, 933041473, 842716292, 287698511, 321629613, 701644675, 298689452, 37392152, 215206366, 466978313, 869750207, 436457437, 839002773, 713204387, 847938809, 469187644, 358591815, 156760149, 905259859, 228519174, 331983868, 325590457, 123887351, 332060143, 890497047, 731372152, 221040327, 306046062, 42282193, 460064089, 912855380, 295871781, 711176487, 952608059, 620593106, 777516795, 481782529, 957086532, 679837422, 557442460, 335453126, 122045942, 78554217, 790550779, 213628999, 11654954, 811957615, 274672241, 662947707, 403253923, 690982335, 127269677, 35288593, 938134852, 733892117, 31487955, 420725059, 550758158, 911716441, 352560081, 305018161, 604125287, 955333841, 885213012, 679856362, 939403809, 17884788, 802610033, 805913880, 38478403, 555224188, 203165451, 349704193, 352327996, 794763265, 462065063, 363330167, 449778376, 569616598, 60164298, 340901582, 654502426, 331560483, 923722311, 803051503, 326205928, 79989583, 749623891, 384334266, 34684378, 810607068, 143956382, 975459144, 435010910, 305132681, 431316555, 930659908, 646274270, 967012642, 908083384, 429125171, 193041943, 902888837, 814120061, 916043833, 428564848, 589281585, 495962914, 150695189, 648249890, 829463274, 964828672, 822616851, 649172124, 846435043, 811055606, 109264359, 233917639, 403129723, 22623532, 650535994, 894921962, 179273260, 437992708, 324742384, 464374772, 133646007, 301978158, 666908587, 571416015, 278702532, 268858562, 803716946, 793497313, 139305559, 672739635, 492457194, 971908471, 78260578, 198565811, 405155585, 658667163, 79383778, 668042616, 131905599, 102444257, 84681044, 259803593, 904691148, 386464156, 725859318, 922133387, 79137120, 518464540, 560501880, 861496300, 648643953, 580299143, 450669054, 746729116, 207025101, 981331593, 151237028, 245341692, 299807251, 412621557, 545165921, 573813176, 514006318, 844986078, 89498346, 306973018, 31773720, 686475857, 170992328, 987969692, 229432887, 776286867, 396850782, 771644038, 290081366, 539894114, 410430877, 594809185, 617003815, 754583908, 785160389, 276220517, 8162139, 29710786, 259965166, 145278537, 554712080, 393515740, 612201451, 491015310, 795057101, 464001596, 365901554, 342949460, 657473805, 680991271, 184074675, 743896795, 328093133, 539990636, 125078956, 331831361, 988747739, 970362143, 272103514, 200666209, 960640303, 996335635, 84673017, 914363839, 737067434, 391298328, 355172495, 795337988, 994502643, 563087296, 940019524, 242242346, 129704266, 995748491, 22586903, 243950246, 471155974, 491624110, 354988073, 265652090, 809288828, 462241259, 9704604, 566578299, 520160530, 146936783, 637062424, 954470999, 104055959, 588784204, 118115490, 90430900, 302352440, 115460013, 888565344, 404186456, 991487939, 7330713, 902428127, 310635097, 230409356, 364776640, 283270825, 469088937, 730957731, 217747113, 133887268, 804305222, 262170939, 777835370, 66277559, 127509382, 146472367, 967775839, 42079685, 326551670, 687863856, 553814602, 218718233, 299626647, 616856843, 953907996, 668869259, 541808281, 813928826, 293363080, 565285981, 381110834, 207267063, 50048988, 110807393, 28854395, 963483010, 325446820, 408534595, 436281964, 31394263, 532492112, 109210546, 80768463, 301447180, 867212758, 258652519, 915863753, 230600504, 643472524, 298578832, 158340325, 399634531, 792521463, 885950723, 196906699, 789886488, 447337784, 543442763, 512587434, 566762581, 178352821, 635733416, 918288536, 936080555, 665935514, 750137915, 783374377, 503537287, 193957854, 131574509, 445541093, 826862617, 675488731, 189722633, 498570872, 22219528, 302131160, 800608930, 285816458, 995352485, 625452927, 318715829, 967093907, 264601075, 453422370, 898942163, 353664489, 591786255, 239150698, 51400597, 355406504, 856303493, 268943668, 55073207, 528080972, 388404810, 941920512, 71779166, 831694950, 865310872, 771480407, 185779101, 913504742, 561192963, 862855955, 386622844, 236163626, 627196051, 726909554, 390829462, 188598430, 294954196, 934951493, 815665396, 970997517, 393373551, 69175545, 83652858, 946268518, 880170087, 265453878, 889189760, 294753851, 394313100, 109832647, 155151455, 888035184, 755035435, 876414302, 250939365, 372298588, 209318527, 945777767, 910616020, 283850382, 397516442, 328183928, 734654823, 485595313, 160123453, 909749987, 987392734, 184471096, 878673971, 168300049, 973224283, 652320865, 889295925, 841923181, 808146367, 669280928, 695310259, 640105597, 215756883, 846541561, 171007086, 376065758, 508922022, 828413971, 645004891, 774004923, 572006658, 183307206, 800033425, 97673966, 865356931, 855529537, 104693118, 738700260, 690989921, 450800553, 17970328, 268703392, 892576903, 338178785, 591609013, 154964615, 626675584, 340567313, 827781248, 955803528, 102526278, 631929727, 275072765, 175874019, 267979195, 474449404, 610879489, 956360480, 191939916, 702563295, 414265879, 955531495, 909377916, 623336409, 173135999, 720063135, 783608750, 740745690, 849660765, 54757223, 291938038, 520642552, 532669091, 271150317, 687645564, 663782431, 914157369, 850271474, 609403866, 363963213, 807368949, 353929290, 484101240, 715157635, 448446745, 999253342, 414378553, 458260501, 432619825, 812704760, 378264549, 505997959, 66029652, 488206863, 666443493, 344283022, 315132705, 354369302, 819499666, 563419831, 685985018, 741368626, 378933464, 645734001, 807816583, 39263295, 693526301, 346725111, 427074038, 22272734, 135497145, 952262899, 569592576, 915433740, 70066127, 834030686, 53727396, 155760377, 925542885, 543649277, 230610752, 503750200, 390727889, 968095107, 263474127, 992581495, 97617931, 306502684, 164586279, 510715739, 536894223, 781106999, 59044203, 407974138}, 53152452), 44714201)
}
